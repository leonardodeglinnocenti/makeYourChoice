<!-- Create a Django page to show all surveys -->

{% extends 'base.html' %}
{% load static %}
{% block content %}

    <h1>Surveys</h1>

    <br>

    <!-- don't show elements if user is not logged in -->
    {% if user.is_authenticated %}

        <!-- Create a Django button to open create survey page -->
        <a href="{% url 'createSurvey' %}">
            <button class="new" type="button">Create a new survey</button>
        </a>
        <a href="{% url 'manageSurveys' %}">
            <button class="edit" type="button">Manage surveys</button>
        </a>
        <a href="{% url 'manageCategories' %}">
            <button class="edit" type="button">Manage categories</button>
        </a>

        <h2>Surveys of the categories you follow: </h2>

        <!-- select surveys that haven't been taken by current user -->
        {% if subscribed_surveys|length == 0 %}
            <p style="color: #e68a00">There are no surveys in the categories you follow</p>
        {% endif %}
        <ul class="card">
            {% for survey in surveys %}
                {% if survey in subscribed_surveys %}
                    <li>
                        <h2>{{ survey.name }} </h2>
                        Category: <b>{{ survey.category }}</b> <br>
                        Created by: <b>{{ survey.user }}</b> <br>
                        Deadline: <b>{{ survey.deadline }}</b> <br>
                        Description: <b>{{ survey.description }}</b>
                    <!-- Put a tick if the user has already taken the survey -->
                    {% for response in responses %}
                        {% if response.user == user and response.survey.id == survey.id %}
                            <p class="taken"> &#10004; You already answered to this survey </p> <!-- tick -->
                        {% endif %}
                    {% endfor %}
                    <a href="{% url 'takeSurvey' survey.id %}">
                        <button class="open" type="button">Take</button>
                    </a>
                    {% if user.is_staff %}
                        <a href="{% url 'viewSurvey' survey.id %}">
                            <button class="edit" type="button">Edit</button>
                        </a>
                        <!-- add a button to take survey -->
                        <a href="{% url 'viewResponses' survey.id %}">
                            <button  class="open" type="button">Results</button>
                        </a>
                        <a href="{% url 'deleteSurvey' survey.id %}">
                            <button class="delete" type="button">Delete</button>
                        </a>
                    {% elif survey.user == user %}
                        <a href="{% url 'viewSurvey' survey.id %}">
                            <button class="edit" type="button">Edit</button>
                        </a>
                        <!-- add a button to take survey -->
                        <a href="{% url 'viewResponses' survey.id %}">
                            <button  class="open" type="button">Results</button>
                        </a>
                        <a href="{% url 'deleteSurvey' survey.id %}">
                            <button class="delete" type="button">Delete</button>
                        </a>
                    {% endif %}
                    </li>
                {% endif %}
            {% endfor %}
        </ul>

        <h2>Surveys of the users you follow: </h2>
        {% if followed_users_surveys|length == 0 %}
            <p style="color: #e68a00">The users you follow haven't created any surveys yet</p>
        {% endif %}
        <ul class="card">
            {% for survey in surveys %}
                {% if survey in followed_users_surveys %}
                    <li>
                        <h2>{{ survey.name }} </h2>
                        Category: <b>{{ survey.category }}</b> <br>
                        Created by: <b>{{ survey.user }}</b> <br>
                        Deadline: <b>{{ survey.deadline }}</b> <br>
                        Description: <b>{{ survey.description }}</b>
                    <!-- Put a tick if the user has already taken the survey -->
                    {% for response in responses %}
                        {% if response.user == user and response.survey.id == survey.id %}
                            <p class="taken"> &#10004; You already answered to this survey </p> <!-- tick -->
                        {% endif %}
                    {% endfor %}
                    <a href="{% url 'takeSurvey' survey.id %}">
                        <button class="open" type="button">Take</button>
                    </a>
                    {% if user.is_staff %}
                        <a href="{% url 'viewSurvey' survey.id %}">
                            <button class="edit" type="button">Edit</button>
                        </a>
                        <!-- add a button to take survey -->
                        <a href="{% url 'viewResponses' survey.id %}">
                            <button  class="open" type="button">Results</button>
                        </a>
                        <a href="{% url 'deleteSurvey' survey.id %}">
                            <button class="delete" type="button">Delete</button>
                        </a>
                    {% elif survey.user == user %}
                        <a href="{% url 'viewSurvey' survey.id %}">
                            <button class="edit" type="button">Edit</button>
                        </a>
                        <!-- add a button to take survey -->
                        <a href="{% url 'viewResponses' survey.id %}">
                            <button  class="open" type="button">Results</button>
                        </a>
                        <a href="{% url 'deleteSurvey' survey.id %}">
                            <button class="delete" type="button">Delete</button>
                        </a>
                    {% endif %}
                    </li>
                {% endif %}
            {% endfor %}
        </ul>

    {% else %}
        <p>Please login to view surveys!</p>
    {% endif %}

{% endblock %}

